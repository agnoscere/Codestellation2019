<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Chat</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
        <link href="chatPage.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
        <script src="showText.js"></script>
	</head>
	<body>
		<div class="panel panel-default text-center col-lg-4 hidden-sm hidden-xs hidden-md header">
            <h1>Messages</h1>
        </div>
        <div class="panel panel-default text-center col-lg-8 col-sm-12 header">
            <h1>Name</h1>
        </div>
		<div class="container-fluid">
            <div class="row h-100">
                <div class="col-lg-4 text-center hidden-md hidden-sm hidden-xs well full-len">
                    <h3>Messages</h3>
                    <p>Lorem ipsum dolor..</p>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-8 text-center well full-len">
                    <div id="text-output" class="text-right">
                    </div>
                    <input type="text" class="form-control" id="message-box" placeholder="Text goes here..." onkeypress="pressedEnter(this)"/>
                </div>
            </div>
        </div>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="showText.js"></script>
		<script>
			function getRandomInt(min, max){
				return Math.floor(Math.random() * (max - min + 1)) + min;
			}

			$.urlParam = function(name){
				var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
				console.log(name);

				return results[1] || 0;
			}

			var socket = io();

			var username;
			var countryCode;
			var country;

			var langDict = {
				"US": "english",
				"CN": "chinese",
				"RU": "russian",
			};

			//Sends that the user has connected
			socket.on('connect', function(){
				//This loads up the beginning modal to get your username
				username = $.urlParam('name');
				countryCode = $.urlParam('countCode');
				country = $.urlParam('country');


				if (username == ""){
					username = "User";
				}
				if (country == ""){
					country = "United States";
				}

				socket.emit('notification', username + ' from ' + country + ' has connected');
				socket.emit('userData', {username: username});
			});

			function sendMessage(){
				if ($("#message-box").is(":empty")){
					socket.emit('chat message', {color: "null", username: username, message: $("#message-box").val()});
				}
			}

			//Gets the amount of users connected
			socket.on('usersOn', function(usersOn){
			})

			//Sends a notification that a user has disconnected
			socket.on('disconnect', function(){
				socket.emit('notification', username + ' has disconnected');
			});

			//Creates notification in the messages box
			socket.on('notification', function(notification){

			})

			//Creates message in the messages box
			socket.on('chat message', function(msg){

				var outputBox = document.getElementById("text-output");
				var messageCont = document.createElement("div");
				var message = document.createElement("p");
				console.log("2");

				if (username == msg.username) {
					messageCont.setAttribute("class", "messageCont");
					message.setAttribute("class", "message");
				} else {
					messageCont.setAttribute("class", "incomingMsgCont");
					message.setAttribute("class", "message");
				}



				message.innerHTML = msg.message;
				messageCont.append(message);

				outputBox.append(messageCont);
				outputBox.append(document.createElement("br"));
				document.getElementById("message-box").value = "";

				outputBox.scrollTop = outputBox.scrollHeight;
			})
		</script>
	</body>
</html>
